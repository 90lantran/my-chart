<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<script src="../jquery/dist/jquery.js"></script>
<script src="../iron-meta/iron-meta.html"></script>
<script src="../iron-signals/iron-signals.html"></script>
 <link rel="import" href="my-chart.html">

<dom-module id="wrapper-el">
<template>
	<style>
	:host{
		display: inline-block;
	}
	</style>

	<!-- <iron-meta id="meta"></iron-meta> -->
	
	<my-chart id="chart" data-x="{{dataX}}" data-y="{{dataY}}"></my-chart>

	<!-- <iron-signals on-iron-signal-hello="_mySignalEvent"></iron-signals> -->
</template>

<script>

Polymer({
	is:'wrapper-el',
	properties:{
		dataTempx:{
			type: Object,
			notify: true,
			observer: '_dataTempx'
		},
		dataTempy:{
			type: Array,
			notify: true,
			observer: '_dataTempy'
		},
		keyX:{
			type: Object,
			notify: true
		},
		keyY:{
			type: Object,
			notify: true
		},
		dataX: {
			type: Array,
			notify: true
		},
		dataY: {
			type: Array,
			notify: true
		},
		dataXLoaded:{
			type:Boolean,
			notify:true,
			reflectToAttribute:true,
			value:false
		},
		dataYLoaded:{
			type:Boolean,
			notify:true,
			reflectToAttribute: true,
			value:false
		}
	
	},

	_dataTempx: function(){
			console.log(this.dataTempx);
			this.dataXLoaded = true;
	},

	_dataTempy: function(){
			console.log(this.dataTempy);
			this.dataYLoaded = true;
	},

	// listeners: {
 //        'dataLoaded': 'updateAttribute'
 //     },

   

     // updateAttribute: function(e) {
     // 	console.log("In updateAttribute");
     //  	console.log(e);
     //  	if (this.keyX.key == e.id) {
     //  		this.keyX.dataLoaded = true;
     //  	}

     //     if (this.keyY.key == e.id) {
     //  		this.keyY.dataLoaded = true;
     //  	}
     // },


     attributeChanged: function() {
     		console.log("In attributeChanged");
     	if(this.dataXLoaded == true && this.dataYLoaded == true) {
  			this._dataCreated();
  		}

     },

	// This code  was implemented to get rid of line 68 in data-source.html
	// but it does not work for now
	
	ready: function(){
  		console.log("in ready of wrapper-el");

  		console.log(this.dataTempx);

  		console.log(this);
  		// var self = this;
  		// var domObserver = Polymer.dom(Polymer.dom(this).parentNode).observeNodes(function(info){
  		// 	console.log(info);
  		// 	console.log($(info.target));

  		// 	console.log($(info.target).find('#' + self.keyX.key));

  		// 	if($(info.target).find('#' + self.keyX.key) != null && $(info.target).find('#' + self.keyY.key) != null) {
  		// 		self._dataCreated();
  		// 	}

  		// 	//if (info.target.lastElementChild.keyX != null && info.target.lastElementChild.keyY != null){
  		// 	//	self._dataCreated();
  		// 	//}
  			
  		// });	
	//this._handleEvent();
	
	},

	_dataCreated: function() {
		// Pass data from the dom to dataX and dataY of <my-chart>, and plot
		// console.log(this.keyX);
		// console.log(this.keyY);

		// var dataXX = this.$.meta.byKey(this.keyX.key);
		// var dataYY = this.$.meta.byKey(this.keyY.key);

		var dataXX = this.dataTempx;
		var dataYY = this.dataTempy;

		console.log(dataXX);
		console.log(dataYY);

		// DO NOT DO THIS, USE TEMP variables
		//this.dataX = [];
		//this.dataY = [];
		
		var tempx =[], tempy=[];

        for(var i = 0; i < dataXX.length; i++){
          tempx.push(dataXX[i][this.keyX.measurement]);
        }

        for(var j = 0; j < dataYY.length; j++){
          tempy.push(dataYY[j][this.keyY.measurement]);
        }

        this.dataX = tempx;
        this.dataY = tempy;
		
		console.log("In _dataCreated");
		console.log(this.dataX);
		console.log(this.dataY);
														 
	}
	
});

</script>

</dom-module>